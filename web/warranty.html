<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeriReceipt - Warranty Claims Fraud Detection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }
        
        .dropzone {
            border: 3px dashed #cbd5e0;
            transition: all 0.3s ease;
        }
        
        .dropzone.drag-over {
            border-color: #667eea;
            background-color: #f7fafc;
        }
        
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .badge-approve {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .badge-review {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .badge-investigate {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .signal-high { background-color: #fef2f2; border-left: 4px solid #ef4444; }
        .signal-medium { background-color: #fffbeb; border-left: 4px solid #f59e0b; }
        .signal-low { background-color: #f0fdf4; border-left: 4px solid #22c55e; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const API_BASE_URL = window.location.origin;

        function App() {
            const [file, setFile] = useState(null);
            const [preview, setPreview] = useState(null);
            const [analyzing, setAnalyzing] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState(null);
            const [dragOver, setDragOver] = useState(false);
            const [dealerId, setDealerId] = useState('');
            const [feedbackSubmitted, setFeedbackSubmitted] = useState(false);
            const [feedbackVerdict, setFeedbackVerdict] = useState(null);
            const [feedbackError, setFeedbackError] = useState(null);
            const [dupAudit, setDupAudit] = useState(null);
            const [dupExpanded, setDupExpanded] = useState({});
            const fileInputRef = useRef(null);

            const loadDuplicateAudit = async (claimId) => {
                try {
                    const resp = await fetch(`${API_BASE_URL}/warranty/duplicates/${claimId}`);
                    if (resp.ok) {
                        const data = await resp.json();
                        setDupAudit(data);
                    }
                } catch (e) {
                    console.error('Failed to load duplicate audit:', e);
                }
            };

            const toggleDupExpand = (idx) => {
                setDupExpanded(prev => ({ ...prev, [idx]: !prev[idx] }));
            };

            const getMatchIcon = (type) => {
                switch(type) {
                    case 'IMAGE_EXACT': return { icon: 'fa-clone', color: 'text-red-600', bg: 'bg-red-100' };
                    case 'IMAGE_LIKELY_SAME': return { icon: 'fa-images', color: 'text-orange-600', bg: 'bg-orange-100' };
                    case 'IMAGE_SIMILAR': return { icon: 'fa-photo-video', color: 'text-yellow-600', bg: 'bg-yellow-100' };
                    case 'VIN_ISSUE_DUPLICATE': return { icon: 'fa-car', color: 'text-purple-600', bg: 'bg-purple-100' };
                    default: return { icon: 'fa-copy', color: 'text-gray-600', bg: 'bg-gray-100' };
                }
            };

            const handleFile = (selectedFile) => {
                if (selectedFile && selectedFile.type === 'application/pdf') {
                    setFile(selectedFile);
                    setPreview(URL.createObjectURL(selectedFile));
                    setResult(null);
                    setError(null);
                    setFeedbackSubmitted(false);
                } else {
                    setError('Please upload a PDF file');
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setDragOver(false);
                const droppedFile = e.dataTransfer.files[0];
                handleFile(droppedFile);
            };

            const analyzeWarranty = async () => {
                if (!file) return;
                
                setAnalyzing(true);
                setError(null);
                setResult(null);

                const formData = new FormData();
                formData.append('file', file);
                if (dealerId) {
                    formData.append('dealer_id', dealerId);
                }

                try {
                    const response = await fetch(`${API_BASE_URL}/warranty/analyze`, {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`Analysis failed: ${response.statusText}`);
                    }

                    const data = await response.json();
                    setResult(data);
                    setDupAudit(null);
                    setDupExpanded({});
                    // Load enriched duplicate audit
                    if (data.claim_id && data.duplicates_found?.length > 0) {
                        loadDuplicateAudit(data.claim_id);
                    }
                    // Clear upload form after successful analysis
                    setFile(null);
                    setPreview(null);
                    setDealerId('');
                    setFeedbackSubmitted(false);
                    setFeedbackVerdict(null);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setAnalyzing(false);
                }
            };

            const submitFeedback = async (verdict) => {
                if (!result?.claim_id) {
                    setFeedbackError('No claim ID available. Please analyze a document first.');
                    return;
                }
                setFeedbackError(null);

                try {
                    const response = await fetch(`${API_BASE_URL}/warranty/feedback`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            claim_id: result.claim_id,
                            verdict: verdict,
                            adjuster_id: 'web_user',
                            notes: `Feedback from web UI: ${verdict}`
                        })
                    });

                    if (response.ok) {
                        setFeedbackSubmitted(true);
                        setFeedbackVerdict(verdict);
                    } else {
                        const errData = await response.json().catch(() => ({}));
                        setFeedbackError(`Feedback failed (${response.status}): ${errData.detail || response.statusText}`);
                    }
                } catch (err) {
                    setFeedbackError(`Feedback error: ${err.message}`);
                    console.error('Feedback error:', err);
                }
            };

            const getTriageBadgeClass = (triage) => {
                switch(triage) {
                    case 'AUTO_APPROVE': return 'badge-approve';
                    case 'REVIEW': return 'badge-review';
                    case 'INVESTIGATE': return 'badge-investigate';
                    default: return 'bg-gray-500';
                }
            };

            const getTriageIcon = (triage) => {
                switch(triage) {
                    case 'AUTO_APPROVE': return 'fa-check-circle';
                    case 'REVIEW': return 'fa-exclamation-circle';
                    case 'INVESTIGATE': return 'fa-exclamation-triangle';
                    default: return 'fa-question-circle';
                }
            };

            const getSeverityClass = (severity) => {
                switch(severity) {
                    case 'HIGH': return 'signal-high';
                    case 'MEDIUM': return 'signal-medium';
                    case 'LOW': return 'signal-low';
                    default: return '';
                }
            };

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <header className="gradient-bg text-white py-8 shadow-lg">
                        <div className="container mx-auto px-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-4">
                                    <i className="fas fa-shield-alt text-4xl"></i>
                                    <div>
                                        <h1 className="text-4xl font-bold">VeriReceipt</h1>
                                        <p className="text-purple-200">Real-Time AI Fraud Detection</p>
                                    </div>
                                </div>
                                <div className="text-right flex items-center space-x-4">
                                    <a href="/web/warranty_dashboard.html" className="px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition text-white">
                                        <i className="fas fa-tachometer-alt mr-2"></i>
                                        Dashboard
                                    </a>
                                    <a href="/web/index.html" className="px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition text-white">
                                        <i className="fas fa-receipt mr-2"></i>
                                        Receipt Analysis
                                    </a>
                                    <a href="/web/stats.html" className="px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition text-white">
                                        <i className="fas fa-chart-bar mr-2"></i>
                                        Analytics
                                    </a>
                                    <div>
                                        <div className="text-sm text-purple-200">Warranty Claims</div>
                                        <div className="font-semibold">AI Fraud Detection</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto py-8 px-4">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            {/* Upload Section */}
                            <div className="bg-white rounded-2xl card-shadow p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">
                                    <i className="fas fa-upload mr-2 text-blue-600"></i>
                                    Upload Warranty Claim
                                </h2>

                                {/* Dealer ID Input */}
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                        Dealer ID (Optional)
                                    </label>
                                    <input
                                        type="text"
                                        value={dealerId}
                                        onChange={(e) => setDealerId(e.target.value)}
                                        placeholder="Enter dealer ID for tracking"
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />
                                </div>

                                {/* Dropzone */}
                                <div
                                    className={`dropzone rounded-xl p-8 text-center cursor-pointer ${dragOver ? 'drag-over' : ''}`}
                                    onDragOver={(e) => { e.preventDefault(); setDragOver(true); }}
                                    onDragLeave={() => setDragOver(false)}
                                    onDrop={handleDrop}
                                    onClick={() => fileInputRef.current?.click()}
                                >
                                    <input
                                        type="file"
                                        ref={fileInputRef}
                                        className="hidden"
                                        accept=".pdf"
                                        onChange={(e) => handleFile(e.target.files[0])}
                                    />
                                    {preview ? (
                                        <div className="space-y-4">
                                            <i className="fas fa-file-pdf text-6xl text-red-500"></i>
                                            <p className="font-medium text-gray-700">{file?.name}</p>
                                            <p className="text-sm text-gray-500">{(file?.size / 1024).toFixed(1)} KB</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-4">
                                            <i className="fas fa-cloud-upload-alt text-5xl text-gray-400"></i>
                                            <p className="text-gray-600">Drag & drop warranty claim PDF here</p>
                                            <p className="text-sm text-gray-400">or click to browse</p>
                                        </div>
                                    )}
                                </div>

                                {/* Analyze Button */}
                                <button
                                    onClick={analyzeWarranty}
                                    disabled={!file || analyzing}
                                    className={`w-full mt-6 py-4 rounded-xl text-white font-semibold transition ${
                                        !file || analyzing
                                            ? 'bg-gray-300 cursor-not-allowed'
                                            : 'bg-blue-600 hover:bg-blue-700'
                                    }`}
                                >
                                    {analyzing ? (
                                        <span className="flex items-center justify-center space-x-2">
                                            <div className="spinner"></div>
                                            <span>Analyzing Claim...</span>
                                        </span>
                                    ) : (
                                        <span><i className="fas fa-search mr-2"></i>Analyze for Fraud</span>
                                    )}
                                </button>

                                {error && (
                                    <div className="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700">
                                        <i className="fas fa-exclamation-circle mr-2"></i>{error}
                                    </div>
                                )}
                            </div>

                            {/* Results Section */}
                            <div className="bg-white rounded-2xl card-shadow p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">
                                    <i className="fas fa-clipboard-check mr-2 text-blue-600"></i>
                                    Analysis Results
                                </h2>

                                {!result && !analyzing && (
                                    <div className="text-center py-16 text-gray-400">
                                        <i className="fas fa-file-invoice text-6xl mb-4"></i>
                                        <p>Upload a warranty claim to see results</p>
                                    </div>
                                )}

                                {analyzing && (
                                    <div className="text-center py-16">
                                        <div className="spinner mx-auto mb-4" style={{width: '48px', height: '48px'}}></div>
                                        <p className="text-gray-600">Analyzing warranty claim...</p>
                                        <p className="text-sm text-gray-400 mt-2">Checking for duplicates, validating data, detecting fraud signals</p>
                                    </div>
                                )}

                                {result && (
                                    <div className="space-y-6 fade-in">
                                        {/* Triage Badge */}
                                        <div className="text-center">
                                            <span className={`inline-flex items-center px-6 py-3 rounded-full text-white font-bold text-lg ${getTriageBadgeClass(result.triage_class)}`}>
                                                <i className={`fas ${getTriageIcon(result.triage_class)} mr-2`}></i>
                                                {result.triage_class.replace('_', ' ')}
                                            </span>
                                            <p className="mt-2 text-gray-600">
                                                Risk Score: <span className="font-bold text-xl">{(result.risk_score * 100).toFixed(0)}%</span>
                                            </p>
                                        </div>

                                        {/* Claim Details */}
                                        <div className="bg-gray-50 rounded-xl p-4">
                                            <h3 className="font-semibold text-gray-700 mb-3">
                                                <i className="fas fa-info-circle mr-2"></i>Claim Details
                                            </h3>
                                            <div className="grid grid-cols-2 gap-3 text-sm">
                                                <div><span className="text-gray-500">Claim ID:</span> <span className="font-medium">{result.claim_id}</span></div>
                                                <div><span className="text-gray-500">Customer:</span> <span className="font-medium">{result.customer_name || 'N/A'}</span></div>
                                                <div><span className="text-gray-500">Vehicle:</span> <span className="font-medium">{result.brand} {result.model} ({result.year})</span></div>
                                                <div><span className="text-gray-500">VIN:</span> <span className="font-medium font-mono text-xs">{result.vin || 'N/A'}</span></div>
                                                <div><span className="text-gray-500">Issue:</span> <span className="font-medium">{result.issue_description}</span></div>
                                                <div><span className="text-gray-500">Claim Date:</span> <span className="font-medium">{result.claim_date}</span></div>
                                                <div><span className="text-gray-500">Total:</span> <span className="font-medium text-green-600">${result.total_amount?.toFixed(2)}</span></div>
                                                <div><span className="text-gray-500">Images:</span> <span className="font-medium">{result.images_extracted}</span></div>
                                            </div>
                                        </div>

                                        {/* Cost Breakdown */}
                                        <div className="bg-blue-50 rounded-xl p-4">
                                            <h3 className="font-semibold text-gray-700 mb-3">
                                                <i className="fas fa-dollar-sign mr-2"></i>Cost Breakdown
                                            </h3>
                                            <div className="grid grid-cols-3 gap-3 text-center">
                                                <div>
                                                    <p className="text-2xl font-bold text-blue-600">${result.parts_cost?.toFixed(2) || '0.00'}</p>
                                                    <p className="text-xs text-gray-500">Parts</p>
                                                </div>
                                                <div>
                                                    <p className="text-2xl font-bold text-blue-600">${result.labor_cost?.toFixed(2) || '0.00'}</p>
                                                    <p className="text-xs text-gray-500">Labor</p>
                                                </div>
                                                <div>
                                                    <p className="text-2xl font-bold text-blue-600">${result.tax?.toFixed(2) || '0.00'}</p>
                                                    <p className="text-xs text-gray-500">Tax</p>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Duplicates Found — Enriched Audit */}
                                        {result.duplicates_found?.length > 0 && (
                                            <div className="bg-red-50 border border-red-200 rounded-xl p-4">
                                                <h3 className="font-semibold text-red-700 mb-1">
                                                    <i className="fas fa-copy mr-2"></i>
                                                    Duplicate Audit
                                                </h3>
                                                <p className="text-xs text-red-500 mb-3">
                                                    {dupAudit
                                                        ? `${dupAudit.total_duplicates} linked claim(s), ${dupAudit.total_matches} match(es)`
                                                        : `${result.duplicates_found.length} match(es) detected`}
                                                </p>

                                                {/* Grouped audit (enriched) */}
                                                {dupAudit?.grouped?.map((group, gIdx) => {
                                                    const expanded = dupExpanded[gIdx];
                                                    const cd = group.claim_details;
                                                    return (
                                                        <div key={gIdx} className="bg-white rounded-lg mb-3 border border-red-100 overflow-hidden">
                                                            {/* Header — always visible */}
                                                            <div
                                                                className="p-3 cursor-pointer hover:bg-red-50 transition flex items-center justify-between"
                                                                onClick={() => toggleDupExpand(gIdx)}
                                                            >
                                                                <div className="flex items-center space-x-3 flex-1 min-w-0">
                                                                    <div className="flex -space-x-1">
                                                                        {group.reason_types?.map((rt, ri) => {
                                                                            const mi = getMatchIcon(rt);
                                                                            return (
                                                                                <span key={ri} className={`inline-flex items-center justify-center w-7 h-7 rounded-full ${mi.bg} ${mi.color} text-xs`}>
                                                                                    <i className={`fas ${mi.icon}`}></i>
                                                                                </span>
                                                                            );
                                                                        })}
                                                                    </div>
                                                                    <div className="min-w-0 flex-1">
                                                                        <p className="font-medium text-sm text-gray-800 truncate">
                                                                            Claim {group.matched_claim_id?.substring(0, 12)}...
                                                                        </p>
                                                                        <p className="text-xs text-gray-500 truncate">
                                                                            {group.reason_summary?.join(' + ')}
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                                <div className="flex items-center space-x-3 ml-2">
                                                                    <span className="text-xs font-bold text-red-600 bg-red-100 px-2 py-1 rounded-full">
                                                                        {(group.max_similarity * 100).toFixed(0)}%
                                                                    </span>
                                                                    <i className={`fas fa-chevron-${expanded ? 'up' : 'down'} text-gray-400 text-xs`}></i>
                                                                </div>
                                                            </div>

                                                            {/* Expanded detail */}
                                                            {expanded && (
                                                                <div className="border-t border-red-100 p-3 bg-gray-50 text-sm space-y-3">
                                                                    {/* Linked claim details */}
                                                                    {cd && (
                                                                        <div>
                                                                            <p className="font-semibold text-gray-700 mb-1">
                                                                                <i className="fas fa-link mr-1 text-blue-500"></i>Linked Claim Details
                                                                            </p>
                                                                            <div className="grid grid-cols-2 gap-2 text-xs bg-white rounded p-2 border">
                                                                                <div><span className="text-gray-400">Claim ID:</span> <span className="font-mono">{cd.id?.substring(0, 16)}</span></div>
                                                                                <div><span className="text-gray-400">Customer:</span> {cd.customer_name || 'N/A'}</div>
                                                                                <div><span className="text-gray-400">VIN:</span> <span className="font-mono">{cd.vin || 'N/A'}</span></div>
                                                                                <div><span className="text-gray-400">Vehicle:</span> {cd.brand} {cd.model} ({cd.year})</div>
                                                                                <div><span className="text-gray-400">Issue:</span> {cd.issue_description || 'N/A'}</div>
                                                                                <div><span className="text-gray-400">Date:</span> {cd.claim_date || 'N/A'}</div>
                                                                                <div><span className="text-gray-400">Total:</span> <span className="text-green-600 font-medium">${cd.total_amount?.toFixed(2) || '0.00'}</span></div>
                                                                                <div><span className="text-gray-400">Risk:</span>
                                                                                    <span className={`font-medium ${cd.risk_score > 0.6 ? 'text-red-600' : cd.risk_score > 0.3 ? 'text-yellow-600' : 'text-green-600'}`}>
                                                                                        {(cd.risk_score * 100).toFixed(0)}%
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    )}

                                                                    {/* Individual match reasons */}
                                                                    <div>
                                                                        <p className="font-semibold text-gray-700 mb-1">
                                                                            <i className="fas fa-search-plus mr-1 text-orange-500"></i>Match Reasons ({group.reasons?.length})
                                                                        </p>
                                                                        {group.reasons?.map((r, ri) => {
                                                                            const mi = getMatchIcon(r.match_type);
                                                                            return (
                                                                                <div key={ri} className={`flex items-start space-x-2 p-2 rounded mb-1 ${mi.bg}`}>
                                                                                    <i className={`fas ${mi.icon} ${mi.color} mt-0.5`}></i>
                                                                                    <div className="flex-1">
                                                                                        <span className={`font-medium text-xs ${mi.color}`}>{r.match_type}</span>
                                                                                        <span className="text-xs text-gray-500 ml-2">({(r.similarity_score * 100).toFixed(0)}% match)</span>
                                                                                        {r.details && <p className="text-xs text-gray-600 mt-0.5">{r.details}</p>}
                                                                                        {(r.image_index_1 !== null || r.image_index_2 !== null) && (
                                                                                            <p className="text-xs text-gray-400">
                                                                                                Image #{r.image_index_1 ?? '?'} (this claim) vs Image #{r.image_index_2 ?? '?'} (linked)
                                                                                            </p>
                                                                                        )}
                                                                                    </div>
                                                                                </div>
                                                                            );
                                                                        })}
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}

                                                {/* Fallback if audit not yet loaded */}
                                                {!dupAudit && result.duplicates_found.map((dup, idx) => (
                                                    <div key={idx} className="bg-white rounded-lg p-3 mb-2 border border-red-100">
                                                        <p className="font-medium text-red-600">{dup.match_type}</p>
                                                        <p className="text-sm text-gray-600">Matches claim: {dup.matched_claim_id}</p>
                                                        <p className="text-sm text-gray-500">Similarity: {(dup.similarity_score * 100).toFixed(0)}%</p>
                                                    </div>
                                                ))}
                                            </div>
                                        )}

                                        {/* Fraud Signals */}
                                        {result.fraud_signals?.length > 0 && (
                                            <div>
                                                <h3 className="font-semibold text-gray-700 mb-3">
                                                    <i className="fas fa-flag mr-2 text-red-500"></i>Fraud Signals ({result.fraud_signals.length})
                                                </h3>
                                                <div className="space-y-2">
                                                    {result.fraud_signals.map((signal, idx) => (
                                                        <div key={idx} className={`rounded-lg p-3 ${getSeverityClass(signal.severity)}`}>
                                                            <div className="flex items-center justify-between">
                                                                <span className="font-medium text-sm">{signal.signal_type}</span>
                                                                <span className={`text-xs px-2 py-1 rounded-full ${
                                                                    signal.severity === 'HIGH' ? 'bg-red-500 text-white' :
                                                                    signal.severity === 'MEDIUM' ? 'bg-yellow-500 text-white' :
                                                                    'bg-green-500 text-white'
                                                                }`}>{signal.severity}</span>
                                                            </div>
                                                            <p className="text-sm text-gray-600 mt-1">{signal.description}</p>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        {/* Warnings */}
                                        {result.warnings?.length > 0 && (
                                            <div className="bg-yellow-50 rounded-xl p-4">
                                                <h3 className="font-semibold text-yellow-700 mb-2">
                                                    <i className="fas fa-exclamation-triangle mr-2"></i>Warnings
                                                </h3>
                                                <ul className="text-sm text-yellow-800 space-y-1">
                                                    {result.warnings.map((w, idx) => (
                                                        <li key={idx}>• {w}</li>
                                                    ))}
                                                </ul>
                                            </div>
                                        )}

                                        {/* Summary */}
                                        <div className="bg-gray-100 rounded-xl p-4">
                                            <h3 className="font-semibold text-gray-700 mb-2">
                                                <i className="fas fa-file-alt mr-2"></i>Summary
                                            </h3>
                                            <p className="text-gray-600">{result.summary}</p>
                                            <p className="text-xs text-gray-400 mt-2">
                                                Processing time: {result.processing_time_ms?.toFixed(0)}ms
                                            </p>
                                        </div>

                                        {/* Feedback Section */}
                                        <div className="border-t pt-4">
                                            <h3 className="font-semibold text-gray-700 mb-3">
                                                <i className="fas fa-comment-dots mr-2"></i>Adjuster Feedback
                                            </h3>
                                            {feedbackError && (
                                                <div className="bg-red-50 border border-red-200 rounded-lg p-3 mb-3 text-center">
                                                    <p className="text-red-700 text-sm">{feedbackError}</p>
                                                </div>
                                            )}
                                            {feedbackSubmitted ? (
                                                <div className="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                                                    <i className="fas fa-check-circle text-green-500 text-2xl mb-2"></i>
                                                    <p className="text-green-700">Feedback recorded: <strong>{feedbackVerdict}</strong></p>
                                                </div>
                                            ) : (
                                                <div className="flex space-x-3">
                                                    <button
                                                        onClick={() => submitFeedback('VALID_CLAIM')}
                                                        className="flex-1 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg transition"
                                                    >
                                                        <i className="fas fa-check mr-2"></i>Valid Claim
                                                    </button>
                                                    <button
                                                        onClick={() => submitFeedback('FALSE_POSITIVE')}
                                                        className="flex-1 py-3 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg transition"
                                                    >
                                                        <i className="fas fa-times mr-2"></i>False Positive
                                                    </button>
                                                    <button
                                                        onClick={() => submitFeedback('CONFIRMED_FRAUD')}
                                                        className="flex-1 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg transition"
                                                    >
                                                        <i className="fas fa-ban mr-2"></i>Confirmed Fraud
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Detection Capabilities */}
                        <div className="mt-8 bg-white rounded-2xl card-shadow p-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-6 text-center">
                                <i className="fas fa-shield-alt mr-2 text-blue-600"></i>
                                Fraud Detection Capabilities
                            </h2>
                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                {[
                                    { icon: 'fa-copy', title: 'Duplicate Images', desc: 'Same image across claims' },
                                    { icon: 'fa-id-card', title: 'VIN Validation', desc: 'Format & brand matching' },
                                    { icon: 'fa-tachometer-alt', title: 'Odometer Check', desc: 'Regression detection' },
                                    { icon: 'fa-calculator', title: 'Math Validation', desc: 'Total & ratio checks' },
                                    { icon: 'fa-clock', title: 'Labor Hours', desc: 'Rate & time anomalies' },
                                    { icon: 'fa-store', title: 'Dealer Patterns', desc: 'Spike & history analysis' },
                                    { icon: 'fa-calendar', title: 'Date Validation', desc: 'Future & warranty age' },
                                    { icon: 'fa-chart-line', title: 'Benchmarks', desc: 'Cost vs historical avg' },
                                    { icon: 'fa-redo', title: 'Repeat Claims', desc: 'Same VIN + issue' },
                                    { icon: 'fa-globe', title: 'Tax Geo Check', desc: 'Tax vs country rules' },
                                    { icon: 'fa-images', title: 'Image Count', desc: 'Policy compliance' },
                                    { icon: 'fa-user-tie', title: 'Dealer Risk', desc: 'Historical fraud rate' },
                                ].map((cap, idx) => (
                                    <div key={idx} className="text-center p-3 rounded-lg hover:bg-gray-50 transition">
                                        <i className={`fas ${cap.icon} text-2xl text-blue-500 mb-2`}></i>
                                        <p className="font-medium text-sm text-gray-700">{cap.title}</p>
                                        <p className="text-xs text-gray-400">{cap.desc}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </main>

                    {/* Footer */}
                    <footer className="bg-gray-800 text-white py-6 mt-8">
                        <div className="max-w-7xl mx-auto px-4 text-center">
                            <p className="text-gray-400">
                                <i className="fas fa-shield-alt mr-2"></i>
                                VeriReceipt Warranty Claims Module - ML-Powered Fraud Detection
                            </p>
                        </div>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
