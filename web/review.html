<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeriReceipt Auditor - Document Review Console</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { margin:0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background:#f1f5f9; }
        .split-screen { display:grid; grid-template-columns:1fr 1fr; height:100vh; overflow:hidden; }
        .left-panel { background:#f8fafc; overflow:auto; border-right:1px solid #e2e8f0; }
        .right-panel { background:#f8fafc; overflow:auto; }
        .receipt-image { transition:transform 0.2s; transform-origin:center center; }
        .step-card { background:white; border:1px solid #e2e8f0; border-radius:12px; margin-bottom:16px; overflow:hidden; }
        .step-header { padding:16px 20px; cursor:pointer; user-select:none; display:flex; align-items:center; justify-content:space-between; }
        .step-header:hover { background:#f8fafc; }
        .step-body { padding:0 20px 20px; }
        .step-number { width:28px; height:28px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; font-size:13px; font-weight:700; margin-right:10px; flex-shrink:0; }
        .verdict-option { cursor:pointer; transition:all 0.15s; border:2px solid #e2e8f0; border-radius:12px; padding:16px; text-align:center; }
        .verdict-option:hover { border-color:#94a3b8; box-shadow:0 2px 8px rgba(0,0,0,0.06); }
        .verdict-option.selected-real { border-color:#16a34a; background:#f0fdf4; }
        .verdict-option.selected-suspicious { border-color:#ca8a04; background:#fefce8; }
        .verdict-option.selected-fake { border-color:#dc2626; background:#fef2f2; }
        .tag-btn { display:inline-flex; align-items:center; gap:6px; padding:8px 14px; border:1px solid #e2e8f0; border-radius:8px; cursor:pointer; font-size:13px; color:#475569; transition:all 0.15s; background:white; }
        .tag-btn:hover { border-color:#94a3b8; background:#f8fafc; }
        .tag-btn.active { border-color:#6366f1; background:#eef2ff; color:#4338ca; font-weight:600; }
        .indicator-review { border:1px solid #e2e8f0; border-radius:8px; padding:12px; margin-bottom:8px; background:white; }
        .review-btn { padding:4px 12px; border-radius:6px; font-size:12px; font-weight:600; cursor:pointer; border:1px solid #e2e8f0; transition:all 0.12s; }
        .review-btn:hover { opacity:0.85; }
        .review-btn.sel-correct { background:#dcfce7; border-color:#16a34a; color:#15803d; }
        .review-btn.sel-wrong { background:#fef2f2; border-color:#dc2626; color:#dc2626; }
        .review-btn.sel-unsure { background:#f1f5f9; border-color:#64748b; color:#475569; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // =====================================================================
        // Step Card Component (collapsible section with step number)
        // =====================================================================
        function StepCard({ stepNum, icon, iconColor, title, defaultOpen = true, children }) {
            const [open, setOpen] = useState(defaultOpen);
            return (
                <div className="step-card">
                    <div className="step-header" onClick={() => setOpen(!open)}>
                        <div className="flex items-center">
                            <span className={`step-number ${iconColor || 'bg-indigo-100 text-indigo-600'}`}>
                                {icon ? <i className={`fas ${icon} text-xs`}></i> : stepNum}
                            </span>
                            <h3 className="font-semibold text-gray-800 text-[15px]">{title}</h3>
                        </div>
                        <i className={`fas fa-chevron-${open ? 'up' : 'down'} text-gray-400 text-sm`}></i>
                    </div>
                    {open && <div className="step-body">{children}</div>}
                </div>
            );
        }

        // =====================================================================
        // Main Review Page - 8-Step Auditor Workflow
        // =====================================================================
        function ReviewPage() {
            const [receipt, setReceipt] = useState(null);
            const [loading, setLoading] = useState(true);
            const [zoom, setZoom] = useState(1.0);

            // Step 1: Verdict
            const [humanLabel, setHumanLabel] = useState('');
            // Step 2: Indicator reviews
            const [indicatorReviews, setIndicatorReviews] = useState({});
            // Step 3: Missed issues
            const [missedIndicators, setMissedIndicators] = useState([]);
            // Step 4: Data corrections
            const [corrections, setCorrections] = useState({});
            // Step 5: Font analysis
            const [fontManipulation, setFontManipulation] = useState(false);
            const [fontNotes, setFontNotes] = useState('');
            // Step 6: Address validation
            const [addressIssues, setAddressIssues] = useState('');
            // Step 7: Visual integrity
            const [visualIssues, setVisualIssues] = useState('');
            // Step 8: Amount verification
            const [amountNotes, setAmountNotes] = useState('');
            // Additional notes
            const [additionalNotes, setAdditionalNotes] = useState('');
            // Submission
            const [submitting, setSubmitting] = useState(false);
            const [submitted, setSubmitted] = useState(false);

            const receiptId = new URLSearchParams(window.location.search).get('id');

            useEffect(() => {
                const storedData = sessionStorage.getItem('currentReceipt');
                if (storedData) {
                    try {
                        const data = JSON.parse(storedData);
                        let imageUrl = data.image_url || '';
                        if (imageUrl === 'SESSION_STORAGE') {
                            imageUrl = sessionStorage.getItem('receiptPreview') || '';
                        }
                        setReceipt({
                            id: receiptId || data.receipt_id || 'unknown',
                            image_url: imageUrl,
                            verdict: data.verdict || 'suspicious',
                            confidence: data.confidence || 0.5,
                            models: data.models || {},
                            extracted: data.extracted || {},
                        });
                    } catch (e) {
                        setReceipt({ id: receiptId || 'unknown', image_url:'', verdict:'suspicious', confidence:0.5, models:{}, extracted:{} });
                    }
                } else {
                    setReceipt({ id: receiptId || 'unknown', image_url:'', verdict:'suspicious', confidence:0.5, models:{}, extracted:{} });
                }
                setLoading(false);
            }, [receiptId]);

            const events = useMemo(() => receipt?.models?.rule_based?.events || [], [receipt]);
            const scorableEvents = useMemo(() => events.filter(e => (e.severity||'').toUpperCase() !== 'INFO' && (e.weight||0) > 0), [events]);
            const ruleScore = receipt?.models?.rule_based?.score;
            const confidencePct = Math.round((ruleScore || receipt?.confidence || 0) * 100);

            const handleIndicatorReview = (ruleId, status, note = '') => {
                setIndicatorReviews(prev => ({ ...prev, [ruleId]: { status, note } }));
            };

            const handleSubmit = async () => {
                if (!humanLabel) { alert('Please select your verdict in Step 1'); return; }
                setSubmitting(true);

                const falseIndicators = Object.entries(indicatorReviews)
                    .filter(([_, r]) => r.status === 'wrong')
                    .map(([id, r]) => `${id}: ${r.note || 'No reason'}`);
                const confirmedIndicators = Object.entries(indicatorReviews)
                    .filter(([_, r]) => r.status === 'correct')
                    .map(([id]) => id);

                const feedbackData = {
                    receipt_id: receipt.id,
                    correct_verdict: humanLabel.toLowerCase(),
                    user_notes: additionalNotes || null,
                    missed_indicators: missedIndicators,
                    false_indicators: falseIndicators,
                    confirmed_indicators: confirmedIndicators,
                    data_corrections: corrections,
                    font_manipulation: fontManipulation,
                    address_issues: addressIssues || null,
                    visual_integrity_issues: visualIssues || null,
                    amount_verification_notes: amountNotes || null,
                };

                try {
                    const res = await fetch(`${window.location.origin}/feedback/submit`, {
                        method:'POST', headers:{'Content-Type':'application/json'},
                        body: JSON.stringify(feedbackData)
                    });
                    if (res.ok) {
                        setSubmitted(true);
                        setTimeout(() => { window.location.href = '/'; }, 2000);
                    } else {
                        const err = await res.json();
                        alert(`Failed: ${err.detail || 'Unknown error'}`);
                    }
                } catch (e) {
                    alert(`Error: ${e.message}`);
                } finally {
                    setSubmitting(false);
                }
            };

            if (loading) return (
                <div className="flex items-center justify-center h-screen bg-slate-50">
                    <div className="text-center"><i className="fas fa-spinner fa-spin text-4xl text-indigo-600 mb-4"></i><p className="text-gray-500 mt-3">Loading review...</p></div>
                </div>
            );
            if (submitted) return (
                <div className="flex items-center justify-center h-screen bg-green-50">
                    <div className="text-center">
                        <i className="fas fa-check-circle text-6xl text-green-600 mb-4"></i>
                        <h2 className="text-2xl font-bold text-gray-800 mb-2">Review Submitted</h2>
                        <p className="text-gray-600">System will learn from your corrections. Redirecting...</p>
                    </div>
                </div>
            );

            return (
                <div className="split-screen">
                    {/* ============== LEFT PANEL: Document Preview ============== */}
                    <div className="left-panel">
                        {/* Header bar */}
                        <div className="sticky top-0 z-10 bg-white border-b border-gray-200 px-5 py-3">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <i className="fas fa-file-image text-indigo-500"></i>
                                    <span className="font-semibold text-gray-800">Document Preview</span>
                                </div>
                                <div className="flex items-center gap-2 bg-gray-100 rounded-full px-3 py-1">
                                    <button onClick={() => setZoom(z => Math.max(z-0.2, 0.3))} className="text-gray-500 hover:text-gray-800 px-1"><i className="fas fa-minus text-xs"></i></button>
                                    <input type="range" min="30" max="300" value={zoom*100}
                                        onChange={e => setZoom(parseInt(e.target.value)/100)}
                                        className="w-24 h-1 accent-indigo-500" />
                                    <button onClick={() => setZoom(z => Math.min(z+0.2, 3))} className="text-gray-500 hover:text-gray-800 px-1"><i className="fas fa-plus text-xs"></i></button>
                                    <span className="text-xs text-gray-500 font-mono w-10 text-center">{Math.round(zoom*100)}%</span>
                                </div>
                            </div>
                        </div>

                        {/* Receipt image */}
                        <div className="p-6 flex justify-center">
                            {receipt.image_url ? (
                                <img src={receipt.image_url} alt="Receipt"
                                    className="receipt-image rounded-xl shadow-lg border border-gray-200 max-w-full"
                                    style={{ transform: `scale(${zoom})` }}
                                    onError={(e) => { e.target.onerror=null; e.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="600"><rect width="400" height="600" fill="%23f1f5f9"/><text x="50%" y="50%" text-anchor="middle" fill="%2394a3b8" font-size="16">Image not available</text></svg>'; }}
                                />
                            ) : (
                                <div className="rounded-xl border-2 border-dashed border-gray-300 p-20 text-center w-full">
                                    <i className="fas fa-image text-5xl text-gray-300 mb-4"></i>
                                    <p className="text-gray-400">No image available</p>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* ============== RIGHT PANEL: 8-Step Review Workflow ============== */}
                    <div className="right-panel">
                        {/* Top bar */}
                        <div className="sticky top-0 z-10 bg-white border-b border-gray-200 px-5 py-3 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <i className="fas fa-shield-halved text-indigo-500"></i>
                                <span className="font-bold text-gray-800">VeriReceipt Auditor</span>
                                <span className="text-xs text-gray-400">Document Review Console</span>
                            </div>
                            <div className="flex items-center gap-3">
                                <span className="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded font-mono">ID: {receipt.id?.substring(0, 12)}...</span>
                                <a href="/" className="text-gray-400 hover:text-gray-700 text-sm flex items-center gap-1">
                                    <i className="fas fa-arrow-left"></i> Exit
                                </a>
                            </div>
                        </div>

                        <div className="p-5 pb-32">
                            {/* ===== AI Analysis Summary ===== */}
                            <div className="step-card">
                                <div className="p-5">
                                    <div className="flex items-center gap-2 mb-4">
                                        <i className="fas fa-robot text-indigo-500"></i>
                                        <h3 className="font-bold text-gray-800">AI Analysis Summary</h3>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <div className="text-xs text-gray-500 mb-1">AI Verdict</div>
                                            <div className={`text-xl font-bold uppercase ${
                                                receipt.verdict === 'real' ? 'text-green-600' :
                                                receipt.verdict === 'suspicious' ? 'text-yellow-600' : 'text-red-600'
                                            }`}>{receipt.verdict || 'UNKNOWN'}</div>
                                        </div>
                                        <div>
                                            <div className="text-xs text-gray-500 mb-1">Confidence</div>
                                            <div className="text-xl font-bold text-gray-800">{confidencePct}%</div>
                                        </div>
                                    </div>
                                    {scorableEvents.length > 0 && (
                                        <div className="mt-4 pt-3 border-t border-gray-100">
                                            <div className="text-xs text-gray-500 mb-2">Key Issues Found</div>
                                            <div className="space-y-1">
                                                {scorableEvents.slice(0, 5).map((ev, i) => (
                                                    <div key={i} className="flex items-center gap-2 text-sm">
                                                        <span className={`w-2 h-2 rounded-full flex-shrink-0 ${
                                                            ev.severity === 'CRITICAL' ? 'bg-red-500' :
                                                            ev.severity === 'WARNING' ? 'bg-yellow-500' : 'bg-blue-500'
                                                        }`}></span>
                                                        <span className="text-gray-700 truncate">{ev.message}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* ===== Step 1: Your Verdict ===== */}
                            <StepCard stepNum="1" icon="fa-gavel" iconColor="bg-purple-100 text-purple-600" title="Step 1: Your Verdict" defaultOpen={true}>
                                <p className="text-sm text-gray-500 mb-4">Based on your expert review, what is your verdict?</p>
                                <div className="space-y-3">
                                    {[
                                        { val:'real', icon:'fa-check-circle', color:'green', label:'Real', desc:'Document appears legitimate' },
                                        { val:'suspicious', icon:'fa-exclamation-circle', color:'yellow', label:'Suspicious', desc:'Needs further investigation' },
                                        { val:'fake', icon:'fa-times-circle', color:'blue', label:'Fake', desc:'Document is fraudulent' },
                                    ].map(opt => (
                                        <div key={opt.val}
                                            onClick={() => setHumanLabel(opt.val)}
                                            className={`verdict-option flex items-center gap-4 ${humanLabel === opt.val ? `selected-${opt.val}` : ''}`}>
                                            <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${
                                                opt.val === 'real' ? 'bg-green-100' : opt.val === 'suspicious' ? 'bg-yellow-100' : 'bg-blue-100'
                                            }`}>
                                                <i className={`fas ${opt.icon} ${
                                                    opt.val === 'real' ? 'text-green-600' : opt.val === 'suspicious' ? 'text-yellow-600' : 'text-blue-600'
                                                }`}></i>
                                            </div>
                                            <div className="flex-1 text-left">
                                                <div className="font-semibold text-gray-800">{opt.label}</div>
                                                <div className="text-xs text-gray-500">{opt.desc}</div>
                                            </div>
                                            <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                                                humanLabel === opt.val ? 'border-indigo-500 bg-indigo-500' : 'border-gray-300'
                                            }`}>
                                                {humanLabel === opt.val && <i className="fas fa-check text-white text-[10px]"></i>}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </StepCard>

                            {/* ===== Step 2: Review AI Indicators ===== */}
                            {scorableEvents.length > 0 && (
                                <StepCard stepNum="2" icon="fa-clipboard-check" iconColor="bg-blue-100 text-blue-600" title="Step 2: Review AI Indicators" defaultOpen={true}>
                                    <p className="text-sm text-gray-500 mb-3">Was each AI finding correct?</p>
                                    <div className="space-y-2">
                                        {scorableEvents.map((ev, idx) => (
                                            <div key={idx} className="indicator-review">
                                                <div className="flex items-start justify-between mb-2">
                                                    <div>
                                                        <span className={`inline-block text-[10px] font-bold px-2 py-0.5 rounded-full mr-2 ${
                                                            ev.severity === 'CRITICAL' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700'
                                                        }`}>{ev.severity}</span>
                                                        <span className="text-xs text-gray-400 font-mono">{ev.rule_id}</span>
                                                    </div>
                                                    <span className="text-[10px] text-gray-400">w={ev.weight}</span>
                                                </div>
                                                <p className="text-sm text-gray-800 mb-2">{ev.message}</p>
                                                {ev.reason_text && <p className="text-xs text-gray-500 mb-2 bg-gray-50 rounded p-2">{ev.reason_text}</p>}
                                                <div className="flex gap-2">
                                                    {[
                                                        { val:'correct', label:'Correct', cls:'sel-correct' },
                                                        { val:'wrong', label:'False Alarm', cls:'sel-wrong' },
                                                        { val:'uncertain', label:'Unsure', cls:'sel-unsure' },
                                                    ].map(opt => (
                                                        <button key={opt.val}
                                                            onClick={() => handleIndicatorReview(ev.rule_id, opt.val)}
                                                            className={`review-btn ${indicatorReviews[ev.rule_id]?.status === opt.val ? opt.cls : ''}`}>
                                                            {opt.label}
                                                        </button>
                                                    ))}
                                                </div>
                                                {indicatorReviews[ev.rule_id]?.status === 'wrong' && (
                                                    <input type="text" placeholder="Why is this a false alarm?"
                                                        className="mt-2 w-full border border-gray-200 rounded-lg px-3 py-1.5 text-sm focus:border-indigo-500 focus:outline-none"
                                                        onChange={(e) => handleIndicatorReview(ev.rule_id, 'wrong', e.target.value)} />
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </StepCard>
                            )}

                            {/* ===== Step 3: Missed Issues ===== */}
                            <StepCard stepNum="3" icon="fa-eye-slash" iconColor="bg-orange-100 text-orange-600" title="Step 3: Missed Issues" defaultOpen={true}>
                                <p className="text-sm text-gray-500 mb-3">Did the AI miss any fraud indicators?</p>
                                <div className="flex flex-wrap gap-2">
                                    {[
                                        { id:'spacing_anomalies', label:'Spacing Issues', icon:'fa-arrows-alt-h' },
                                        { id:'font_inconsistencies', label:'Font Problems', icon:'fa-font' },
                                        { id:'invalid_address', label:'Fake Address', icon:'fa-map-marker-alt' },
                                        { id:'date_manipulation', label:'Date Tampering', icon:'fa-calendar-times' },
                                        { id:'amount_tampering', label:'Amount Changed', icon:'fa-dollar-sign' },
                                        { id:'missing_elements', label:'Missing Fields', icon:'fa-puzzle-piece' },
                                    ].map(m => (
                                        <button key={m.id}
                                            onClick={() => setMissedIndicators(prev => prev.includes(m.id) ? prev.filter(i => i !== m.id) : [...prev, m.id])}
                                            className={`tag-btn ${missedIndicators.includes(m.id) ? 'active' : ''}`}>
                                            <i className={`fas ${m.icon} text-xs`}></i>
                                            {m.label}
                                        </button>
                                    ))}
                                </div>
                            </StepCard>

                            {/* ===== Step 4: Data Corrections ===== */}
                            <StepCard stepNum="4" icon="fa-pen-to-square" iconColor="bg-teal-100 text-teal-600" title="Step 4: Data Corrections" defaultOpen={true}>
                                <p className="text-sm text-gray-500 mb-3">If the AI extracted wrong values, provide corrections:</p>
                                <div className="space-y-3">
                                    <div>
                                        <label className="block text-xs font-semibold text-gray-500 mb-1">Merchant</label>
                                        <input type="text" placeholder="Correct merchant name"
                                            defaultValue={receipt.extracted?.merchant?.name || receipt.models?.donut?.merchant || ''}
                                            onChange={(e) => setCorrections(prev => ({ ...prev, merchant: e.target.value }))}
                                            className="w-full border border-gray-200 rounded-lg px-3 py-2.5 text-sm focus:border-indigo-500 focus:outline-none" />
                                    </div>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className="block text-xs font-semibold text-gray-500 mb-1">Total Amount</label>
                                            <input type="number" step="0.01" placeholder="0.00"
                                                defaultValue={receipt.extracted?.total || ''}
                                                onChange={(e) => setCorrections(prev => ({ ...prev, total: parseFloat(e.target.value) }))}
                                                className="w-full border border-gray-200 rounded-lg px-3 py-2.5 text-sm focus:border-indigo-500 focus:outline-none" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-semibold text-gray-500 mb-1">Tax Amount</label>
                                            <input type="number" step="0.01" placeholder="0.00"
                                                defaultValue={receipt.extracted?.tax?.amount || ''}
                                                onChange={(e) => setCorrections(prev => ({ ...prev, tax: parseFloat(e.target.value) }))}
                                                className="w-full border border-gray-200 rounded-lg px-3 py-2.5 text-sm focus:border-indigo-500 focus:outline-none" />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-semibold text-gray-500 mb-1">Receipt Date</label>
                                        <input type="date"
                                            defaultValue={receipt.extracted?.date || ''}
                                            onChange={(e) => setCorrections(prev => ({ ...prev, date: e.target.value }))}
                                            className="w-full border border-gray-200 rounded-lg px-3 py-2.5 text-sm focus:border-indigo-500 focus:outline-none" />
                                    </div>
                                </div>
                            </StepCard>

                            {/* ===== Step 5: Font Analysis ===== */}
                            <StepCard stepNum="5" icon="fa-font" iconColor="bg-amber-100 text-amber-600" title="Step 5: Font Analysis" defaultOpen={false}>
                                <p className="text-sm text-gray-500 mb-3">Did you detect font manipulation or inconsistencies?</p>
                                <label className={`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition ${
                                    fontManipulation ? 'bg-red-50 border-red-300' : 'border-gray-200 hover:bg-gray-50'
                                }`}>
                                    <input type="checkbox" checked={fontManipulation}
                                        onChange={(e) => setFontManipulation(e.target.checked)}
                                        className="w-4 h-4 accent-red-500" />
                                    <i className="fas fa-exclamation-triangle text-red-500"></i>
                                    <span className="text-sm font-medium text-gray-700">Font manipulation detected</span>
                                </label>
                                {fontManipulation && (
                                    <textarea value={fontNotes} onChange={(e) => setFontNotes(e.target.value)}
                                        placeholder="Describe font issues (e.g., mixed fonts, different sizes on amounts)..."
                                        className="mt-3 w-full border border-gray-200 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none" rows="2" />
                                )}
                            </StepCard>

                            {/* ===== Step 6: Address Validation ===== */}
                            <StepCard stepNum="6" icon="fa-map-marker-alt" iconColor="bg-rose-100 text-rose-600" title="Step 6: Address Validation" defaultOpen={false}>
                                <p className="text-sm text-gray-500 mb-3">Is the address on the document valid and consistent?</p>
                                <div className="space-y-2">
                                    {[
                                        { val:'valid', label:'Address looks correct' },
                                        { val:'fake', label:'Address appears fake or fabricated' },
                                        { val:'mismatch', label:'Address does not match merchant location' },
                                        { val:'missing', label:'No address present' },
                                    ].map(opt => (
                                        <label key={opt.val} className={`flex items-center gap-3 p-3 rounded-lg border cursor-pointer text-sm transition ${
                                            addressIssues === opt.val ? 'bg-indigo-50 border-indigo-300' : 'border-gray-200 hover:bg-gray-50'
                                        }`}>
                                            <input type="radio" name="address" value={opt.val}
                                                checked={addressIssues === opt.val}
                                                onChange={() => setAddressIssues(opt.val)}
                                                className="w-4 h-4 accent-indigo-500" />
                                            <span>{opt.label}</span>
                                        </label>
                                    ))}
                                </div>
                            </StepCard>

                            {/* ===== Step 7: Visual Integrity ===== */}
                            <StepCard stepNum="7" icon="fa-eye" iconColor="bg-cyan-100 text-cyan-600" title="Step 7: Visual Integrity" defaultOpen={false}>
                                <p className="text-sm text-gray-500 mb-3">Are there visual signs of tampering?</p>
                                <div className="space-y-2">
                                    {[
                                        { val:'clean', label:'Image appears authentic' },
                                        { val:'edited', label:'Signs of editing/Photoshop detected' },
                                        { val:'screenshot', label:'This is a screenshot, not original' },
                                        { val:'quality', label:'Too low quality to assess' },
                                    ].map(opt => (
                                        <label key={opt.val} className={`flex items-center gap-3 p-3 rounded-lg border cursor-pointer text-sm transition ${
                                            visualIssues === opt.val ? 'bg-indigo-50 border-indigo-300' : 'border-gray-200 hover:bg-gray-50'
                                        }`}>
                                            <input type="radio" name="visual" value={opt.val}
                                                checked={visualIssues === opt.val}
                                                onChange={() => setVisualIssues(opt.val)}
                                                className="w-4 h-4 accent-indigo-500" />
                                            <span>{opt.label}</span>
                                        </label>
                                    ))}
                                </div>
                            </StepCard>

                            {/* ===== Step 8: Amount Verification ===== */}
                            <StepCard stepNum="8" icon="fa-calculator" iconColor="bg-emerald-100 text-emerald-600" title="Step 8: Amount Verification" defaultOpen={false}>
                                <p className="text-sm text-gray-500 mb-3">Do the amounts on the receipt make sense?</p>
                                <div className="space-y-2 mb-3">
                                    {[
                                        { val:'correct', label:'Amounts are correct and add up' },
                                        { val:'math_error', label:'Math does not add up (items vs total)' },
                                        { val:'inflated', label:'Amounts appear inflated/unrealistic' },
                                        { val:'missing', label:'Key amounts are missing' },
                                    ].map(opt => (
                                        <label key={opt.val} className={`flex items-center gap-3 p-3 rounded-lg border cursor-pointer text-sm transition ${
                                            amountNotes === opt.val ? 'bg-indigo-50 border-indigo-300' : 'border-gray-200 hover:bg-gray-50'
                                        }`}>
                                            <input type="radio" name="amount" value={opt.val}
                                                checked={amountNotes === opt.val}
                                                onChange={() => setAmountNotes(opt.val)}
                                                className="w-4 h-4 accent-indigo-500" />
                                            <span>{opt.label}</span>
                                        </label>
                                    ))}
                                </div>
                            </StepCard>

                            {/* ===== Additional Notes ===== */}
                            <StepCard icon="fa-comment-dots" iconColor="bg-slate-200 text-slate-600" title="Additional Notes" defaultOpen={false}>
                                <textarea value={additionalNotes} onChange={(e) => setAdditionalNotes(e.target.value)}
                                    className="w-full border border-gray-200 rounded-lg px-3 py-2.5 text-sm focus:border-indigo-500 focus:outline-none" rows="3"
                                    placeholder="Any other observations or comments for the audit trail..." />
                            </StepCard>

                            {/* ===== Submit ===== */}
                            <div className="sticky bottom-0 bg-gradient-to-t from-slate-100 via-slate-100 to-transparent pt-6 pb-4 -mx-5 px-5">
                                <button onClick={handleSubmit} disabled={!humanLabel || submitting}
                                    className="w-full py-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition disabled:opacity-40 disabled:cursor-not-allowed shadow-lg shadow-indigo-200 text-base flex items-center justify-center gap-2">
                                    {submitting
                                        ? <><i className="fas fa-spinner fa-spin"></i> Submitting...</>
                                        : <><i className="fas fa-paper-plane"></i> Submit Review</>
                                    }
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<ReviewPage />, document.getElementById('root'));
    </script>
</body>
</html>
